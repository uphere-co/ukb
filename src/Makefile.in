# Default target of this Makefile
all::

CCC = @CXX@
AR = ar
STATIC =
#@ENABLE_STATIC@
INCLUDES = -I @BOOST_INCLUDE_DIR@
LDFLAGS = @LDFLAGS@ -lpthread
ifndef UKB_NO_SERVER
CCFLAGS = @CCFLAGS@ -D UKB_SERVER
else
CCFLAGS = @CCFLAGS@
endif

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@
datarootdir = @datarootdir@

INSTALLDIR = ${bindir}

EXEC_SRC = ukb_walkandprint.cc ukb_wsd.cc ukb_ppv.cc compile_kb.cc convert2.0.cc
EXEC = $(notdir $(basename $(EXEC_SRC)))

SOURCES= common.cc globalVars.cc ukbServer.cc configFile.cc fileElem.cc kbGraph.cc kbGraph_common.cc kbGraph_v16.cc disambGraph.cc csentence.cc wdict.cc  walkandprint.cc

MEMBERS=$(SOURCES:.cc=.o)

.PHONY: all install clean

all:: $(EXEC) libukb.so.1 libukb.a

version.h: FORCE
	@$(SHELL_PATH) ./UKB-VERSION-GEN @PACKAGE_VERSION@

globalVars.o: version.h

FORCE:

%.o : %.cc
	$(CCC) -c $(CCFLAGS) -o $@ $(INCLUDES) $<

libukb.a: $(MEMBERS)
	$(AR) rcs libukb.a $(MEMBERS)

libukb.so.1: $(MEMBERS)
	$(CCC) -shared -fPIC -Wl,-soname,libukb.so.1 -o libukb.so.1 $(MEMBERS) $(LDFLAGS)

$(EXEC): $(MEMBERS) $(SRCS) $(EXEC_SRC)
	$(CCC) $(CCFLAGS) -o $@ $@.cc $(MEMBERS) $(INCLUDES) $(STATIC) $(LDFLAGS)

install: $(EXEC) libukb.so.1 libukb.a
	install -d -m 755 $(INSTALLDIR)
	install -d -m 755 $(libdir)
	install -d -m 755 $(includedir)
	@for exec in $(EXEC); do \
	cp -f $$exec $(INSTALLDIR) > /dev/null 2>&1; \
	done; \
	cp -f *.h $(includedir) > /dev/null 2>&1; \
    cp -f libukb.so.1 $(libdir) > /dev/null 2>&1; \
    cd $(libdir); ln -s libukb.so.1 libukb.so 
    #cp -f libukb.a $(libdir) > /dev/null 2>&1;


clean:
	find . -type f -name '*.o' | xargs rm -f
	rm -f $(EXEC)
	rm -f version.h
